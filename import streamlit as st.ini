import streamlit as st
import pandas as pd
from prophet import Prophet
import matplotlib.pyplot as plt

st.set_page_config(page_title="ØªÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ù„Ù„Ø£Ù…Ø±Ø§Ø¶", layout="centered")

st.title("ğŸ“ˆ ØªÙˆÙ‚Ø¹ Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ù„Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©")

st.write("Ø§Ø±ÙØ¹ Ù…Ù„Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØµÙŠØºØ© CSV ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¹Ù…ÙˆØ¯ ds (Ø§Ù„ØªØ§Ø±ÙŠØ®) ÙˆØ¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ (Ù…Ø«Ù„ HEART FAILURE, STEMI, ...)")

uploaded_file = st.file_uploader("Ø§Ø±ÙØ¹ Ù…Ù„Ù CSV", type=["csv"])

if uploaded_file:
    df = pd.read_csv(uploaded_file)
    try:
        df['ds'] = pd.to_datetime(df['ds'])
        diseases = [col for col in df.columns if col != 'ds']
    except Exception as e:
        st.error("ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ù…Ù„Ù ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¹Ù…ÙˆØ¯ ds (ØªØ§Ø±ÙŠØ®) ÙˆØ¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù‡ÙŠ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ù…Ø±Ø§Ø¶")
    else:
        disease = st.selectbox("Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø¶ Ù„Ù„ØªÙˆÙ‚Ø¹", diseases)

        df_selected = df[['ds', disease]].rename(columns={disease: 'y'})

        st.success(f"ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±Ø¶: {disease}")
        st.write("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:")
        st.dataframe(df_selected.tail())

        m = Prophet(yearly_seasonality=True, weekly_seasonality=False, daily_seasonality=False)
        m.fit(df_selected)

        future = m.make_future_dataframe(periods=3, freq='MS')
        forecast = m.predict(future)

        st.subheader("ğŸ“Š Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ù„Ù„Ù€ 3 Ø´Ù‡ÙˆØ± Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©")
        st.dataframe(forecast[['ds', 'yhat']].tail(3).rename(columns={"ds": "Ø§Ù„Ø´Ù‡Ø±", "yhat": "Ø§Ù„ØªÙˆÙ‚Ø¹"}))

        st.subheader("ğŸ“‰ Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„ØªÙˆÙ‚Ø¹")
        fig = m.plot(forecast)
      Â Â st.pyplot(fig)
